---
title: Webpack複製檔案+自動壓縮圖片
date: 2024-05-04
tags: ["Webpack"]
---
## 單純複製檔案
1. 安裝`copy-webpack-plugin`套件
```
$ npm i copy-webpack-plugin -D
```
2. 在`webpack.config.js`新增：
```js
const path = require('path');
const CopyWebpackPlugin = require('copy-webpack-plugin'); //引用套件

module.exports = {
    entry: './src/js/main.js',
    output: {
        path: path.resolve(__dirname,'dist'),
        filename: './js/main.js', 
        clean: true, 
    },
    plugins: [
        new CopyWebpackPlugin({
            patterns:[
                //from是來源路徑，to是輸出路徑
                { from: path.resolve(__dirname,'src/images/favicon') ,to: 'images/favicon' }, 
                { from: path.resolve(__dirname,'src/fonts') ,to: 'fonts' }
            ],
        }),
    ],
}
```
`from是來源路徑，to是輸出路徑，統一使用物件方式包裹`

3. 在`src`底下新增`images/favicon`和`fonts`：
```
you project
├─── node_modules/        
├─── src/
│     │
│     ├──── fonts/ 
│     │
│     └──── images/ 
│            │
│            └── favicon/
│ 
├─── package.json
└─── webpack.config.js   
```
4. 在終端機執行：
```
$ npm run start
```
5. 可以發現資料夾被複製到`dist`底下：
```
you project
├─── dist/
│     │
│     ├──── fonts/ 
│     │
│     └──── images/ 
│            │
│            └── favicon/
│
├─── node_modules/        
├─── src/
│     │
│     ├──── fonts/ 
│     │
│     └──── images/ 
│            │
│            └── favicon/
│ 
├─── package.json
└─── webpack.config.js   
```
`此時images裡的檔案(除了favicon)並不會被複製，因為沒有為該路徑進行複製`

-----------------------------------------------
## 自動壓縮圖片處理
1. 安裝`image-webpack-loader`套件：
```
$ npm i image-webpack-loader -D
```
2. 在`webpack.config.js`新增：
```js
const path = require('path');
const CopyWebpackPlugin = require('copy-webpack-plugin');

module.exports = {
    entry: './src/js/main.js',
    output: {
        path: path.resolve(__dirname,'dist'),
        filename: './js/main.js', 
        clean: true, 
    },
    module:{
        rules: [
            {
                test: /\.(gif|png|jpe?g|svg|webp)$/i, //找尋gif、png、jpeg、jpg、svg、webp副檔名的檔案(正規表達式)
                type: 'asset/resource', //此webpack複製檔案方法
                generator:{
                    filename: 'images/[name][ext]', //輸出的檔名跟輸入時一樣，若不設定則會自動亂數
                },
                use: [
                    {
                        loader: 'images-webpack-loader',
                        options:{
                            mozjpeg: {
                                progressive: true,
                            },
                            optipng: {
                                enabled: false,
                            },
                            pngquant: {
                                quality: [0.65,0.9],
                                speed: 4,
                            },
                            gifsicle: {
                                interlaced: false,
                            },
                            webp:{
                                quality: 75,
                            }
                        },
                    }
                ]
            }
        ]
    },
    plugins: [
        new CopyWebpackPlugin({
            patterns:[
                { from: path.resolve(__dirname,'src/images/favicon') ,to: 'images/favicon' },
                { from: path.resolve(__dirname,'src/fonts') ,to: 'fonts' }
            ],
        }),
    ],
}
```
3. 到main.js將圖片全部引入：
```js
function importAll(r){
    r.keys().forEach(r);
}
importAll(require.context('../images',false,/\.(gif|png|jpe?g|svg|webp)$/i));
```
`此時images裡的檔案會成功的複製，並且經過壓縮處理`